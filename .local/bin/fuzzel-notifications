#!/usr/bin/env bash

if ! command -v makoctl &>/dev/null; then
  notify-send "fuzzel-notifications" "makoctl not found"
  exit 1
fi

raw=$(makoctl history 2>/dev/null)

if [ -z "$raw" ]; then
  notify-send "Notifications" "No notification history found"
  exit 0
fi

history=$(echo "$raw" | grep -E '^Notification [0-9]+' | sed 's/Notification //')

if [ -z "$history" ]; then
  notify-send "Notifications" "No notifications in history"
  exit 0
fi

choice=$(echo "$history" | fuzzel --dmenu --prompt "Notifications > " --lines 20 --width 100)

[ -z "$choice" ] && exit 0

id=$(echo "$choice" | awk -F':' '{print $1}')

details=$(awk -v id="$id" '
  $2 == id ":" {in_block=1; print; next}
  /^Notification / && in_block {exit}
  in_block {print}
' <<< "$raw")

if [ -n "$details" ]; then
  notify-send "Notification $id" "$details"
else
  notify-send "Notification $id" "No details available"
fi

